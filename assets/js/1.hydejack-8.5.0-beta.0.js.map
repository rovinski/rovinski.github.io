{"version":3,"sources":["webpack:///../hy-img/lib/common.js","webpack:///../hy-img/lib/index.js","webpack:///../hy-img/lib/log.js","webpack:///../hy-img/lib/srcset.js"],"names":["isExternal","protocol","host","location","window","subscribeWhen","p$","source","pipe","switchMap","p","NEVER","createResizeObservable","el","Observable","create","obs","observer","ResizeObserver","xs","forEach","x","next","observe","unobserve","createItersectionObservable","options","IntersectionObserver","fetchRx","input","init","controller","AbortController","signal","response","fetch","then","r","complete","catch","error","abort","__decorate","decorators","target","key","desc","c","arguments","length","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","RxLitElement","LitElement","constructor","$connected","Subject","connectedCallback","disconnectedCallback","firstUpdated","firstUpdate","updated","changedProperties","prop","keys","$","HTMLHyImgElement","w","h","strategy","url","visibility","$loadImage","cache","Map","getIsIntersecting","combineLatest","root","rootMargin","document","querySelector","undefined","of","isIntersecting","map","getContentWidth","contentRect","width","startWith","clientWidth","BehaviorSubject","src","srcset","noscript","parentNode","removeChild","$contentWidth","subscribe","contentWidth","height","renderWidth","renderHeight","$trigger","merge","share","filter","distinctUntilChanged","triggered","contentWidth$","$srcset","a","b","p1","p2","q1","q2","parseSrcset","srcsetFromSrc","$url","args","selectSrcsetURL","distinctUntilKeyChanged","$trigger2","fetchImage","catchError","srcsetObj","dpr","devicePixelRatio","selection","select","screen","URL","href","cacheStrategy","fetch$","blob","createObjectURL","has","method","headers","Accept","mode","tap","objectURL","set","get","render","html","styleMap","calcSizerStyle","calcImageStyle","ifDefined","alt","decoding","useMap","style","paddingTop","objURL","revokeObjectURL","loadImage","styles","css","property","type","String","reflect","prototype","attribute","Number","customElement","devAssert","_","userAssert","SrcsetSourceDef","srcsetRegex","srcsetFromElement","element","srcsetAttr","getAttribute","srcAttr","Srcset","s","sources","match","exec","toLowerCase","parseInt","parseFloat","push","sources_","hasWidth","hasDpr","sort","sortByWidth","sortByDpr","widthBased_","index","selectByWidth_","selectByDpr_","minIndex","minScore","Infinity","minWidth","sWidth","score","Math","abs","getUrls","stringify","opt_mapper","res","join","s1","s2"],"mappings":"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","file":"1.hydejack-8.5.0-beta.0.js","sourcesContent":["// export const hasCSSOM = \"attributeStyleMap\" in Element.prototype && \"CSS\" in window && CSS.number;\n/* export const idle = x => new Promise(res => requestIdleCallback(() => res(x))); */\n/* export const anim = x => new Promise(res => requestAnimationFrame(() => res(x))); */\nimport { Observable, NEVER } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\n// Consider a URL external if either the protocol, hostname or port is different.\nexport function isExternal({ protocol, host }, location = window.location) {\n    return protocol !== location.protocol || host !== location.host;\n}\nexport function subscribeWhen(p$) {\n    return (source) => {\n        // if (process.env.DEBUG && !p$) throw Error();\n        return p$.pipe(switchMap(p => (p ? source : NEVER)));\n    };\n}\nexport function createResizeObservable(el) {\n    return Observable.create((obs) => {\n        const observer = new window.ResizeObserver(xs => xs.forEach(x => obs.next(x)));\n        observer.observe(el);\n        return () => { observer.unobserve(el); };\n    });\n}\nexport function createItersectionObservable(el, options) {\n    return Observable.create((obs) => {\n        const observer = new IntersectionObserver(xs => xs.forEach(x => obs.next(x)), options);\n        observer.observe(el);\n        return () => { observer.unobserve(el); };\n    });\n}\nexport function fetchRx(input, init) {\n    return Observable.create((observer) => {\n        const controller = new AbortController();\n        const { signal } = controller;\n        let response = null;\n        fetch(input, { ...init, signal })\n            .then(r => {\n            response = r;\n            observer.next(r);\n            observer.complete();\n        })\n            .catch(x => observer.error(x));\n        return () => { if (!response)\n            controller.abort(); };\n    });\n}\n/*\nfunction blobToDataURL(blob) {\n  return new Promise((res, rej) => {\n    const a = new FileReader();\n    a.onload = ({ target: { result } }) => res(result);\n    a.onerror = rej;\n    a.readAsDataURL(blob);\n  });\n}\n*/\n/*\nconst createObjectURL = blob =>\n  Observable.create(obs => {\n    const objURL = URL.createObjectURL(blob);\n    obs.next(objURL);\n    return () => {\n      if (process.env.DEBUG) console.log(\"revoke\", objURL);\n      URL.revokeObjectURL(objURL);\n    };\n  });\n*/\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n/**\n * Copyright (c) 2019 Florian Klampfer <https://qwtel.com/>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @license\n * @nocompile\n */\n// import { h, Component, Prop, Element, Watch, State, Method } from 'pencil-runtime';\nimport { LitElement, html, css, property, customElement } from 'lit-element';\nimport { styleMap } from 'lit-html/directives/style-map';\nimport { ifDefined } from 'lit-html/directives/if-defined';\nimport { Subject, BehaviorSubject, combineLatest, merge, NEVER, of } from \"rxjs\";\nimport { catchError, distinctUntilChanged, distinctUntilKeyChanged, filter, map, share, startWith, switchMap, tap } from \"rxjs/operators\";\nimport { isExternal, createResizeObservable, createItersectionObservable, fetchRx } from \"./common\";\nimport { parseSrcset, srcsetFromSrc } from './srcset';\nclass RxLitElement extends LitElement {\n    constructor() {\n        super(...arguments);\n        this.$connected = new Subject();\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this.$connected.next(true);\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        this.$connected.next(false);\n    }\n    firstUpdated() {\n        this.firstUpdate = true;\n    }\n    updated(changedProperties) {\n        if (!this.firstUpdate)\n            for (const prop of changedProperties.keys()) {\n                if (prop in this.$)\n                    this.$[prop].next(this[prop]);\n            }\n        this.firstUpdate = false;\n    }\n}\nlet HTMLHyImgElement = class HTMLHyImgElement extends RxLitElement {\n    constructor() {\n        super(...arguments);\n        this.w = 0;\n        this.h = 0;\n        this.strategy = 'cache';\n        this.url = null;\n        this.visibility = 'hidden';\n        this.$ = {};\n        this.$loadImage = new Subject();\n        this.cache = new Map();\n    }\n    getIsIntersecting() {\n        return combineLatest(this.$.root, this.$.rootMargin).pipe(\n        // subscribeWhen(this.connected$),\n        switchMap(([root, rootMargin]) => \"IntersectionObserver\" in window\n            ? createItersectionObservable(this, {\n                root: root ? document.querySelector(root) : undefined,\n                rootMargin,\n            })\n            : of({ isIntersecting: true })), map(({ isIntersecting }) => isIntersecting));\n    }\n    getContentWidth() {\n        return \"ResizeObserver\" in window\n            ? createResizeObservable(this).pipe(map(x => x.contentRect.width), startWith(this.clientWidth))\n            : NEVER;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this.$.root = new BehaviorSubject(this.root);\n        this.$.rootMargin = new BehaviorSubject(this.rootMargin);\n        this.$.w = new BehaviorSubject(this.w);\n        this.$.h = new BehaviorSubject(this.h);\n        this.$.src = new BehaviorSubject(this.src);\n        this.$.srcset = new BehaviorSubject(this.srcset);\n        const noscript = this.querySelector('noscript');\n        if (noscript)\n            noscript.parentNode.removeChild(noscript);\n        const $contentWidth = this.getContentWidth();\n        combineLatest($contentWidth, this.$.w, this.$.h)\n            // .pipe(subscribeWhen(this.connected$))\n            .subscribe(([contentWidth, width, height]) => {\n            this.contentWidth = contentWidth;\n            this.renderWidth = width;\n            this.renderHeight = height;\n        });\n        const $trigger = merge(this.getIsIntersecting(), this.$loadImage).pipe(share());\n        $trigger\n            .pipe(filter(x => !!x), distinctUntilChanged())\n            .subscribe(() => this.triggered($trigger, $contentWidth));\n    }\n    // TODO: rename\n    triggered($trigger, contentWidth$) {\n        // this.loading = true;\n        const $srcset = combineLatest(this.$.src, this.$.srcset).pipe(\n        // subscribeWhen(this.connected$),\n        filter(([a, b]) => a != null || b != null), distinctUntilChanged(([p1, p2], [q1, q2]) => p1 === q1 && p2 === q2), map(([src, srcset]) => (srcset ? parseSrcset(srcset) : srcsetFromSrc(src))));\n        const $url = combineLatest(contentWidth$, $srcset).pipe(map(args => this.selectSrcsetURL(...args)), distinctUntilKeyChanged(\"href\"));\n        const $trigger2 = $trigger.pipe(\n        // distinctUntilChanged(), // ???\n        startWith(true));\n        combineLatest($url, $trigger2).pipe(switchMap(args => this.fetchImage(...args)), catchError(() => $url))\n            .subscribe(url => {\n            this.url = url;\n        });\n    }\n    selectSrcsetURL(width, srcsetObj) {\n        const dpr = window.devicePixelRatio || 1;\n        const selection = srcsetObj.select(width || window.screen.width, dpr);\n        return new URL(selection, window.location.href);\n    }\n    cacheStrategy(fetch$) {\n        switch (this.strategy) {\n            case 'blob': {\n                return fetch$.pipe(switchMap(x => x.blob()), map(blob => URL.createObjectURL(blob)));\n            }\n            case 'cache':\n            default: {\n                return fetch$.pipe(map(x => x.url));\n            }\n        }\n    }\n    fetchImage(url, isIntersecting) {\n        const { href } = url;\n        const { cache } = this;\n        if (isIntersecting && !cache.has(href)) {\n            const fetch$ = fetchRx(href, {\n                method: \"GET\",\n                headers: { Accept: \"image/*\" },\n                mode: isExternal(url) ? 'cors' : undefined,\n            });\n            return this.cacheStrategy(fetch$).pipe(tap(objectURL => cache.set(href, objectURL)));\n        }\n        else if (cache.has(href)) {\n            return of(cache.get(href));\n        }\n        else {\n            return NEVER;\n        }\n    }\n    render() {\n        return html `\n      <div class=\"sizer\" style=${styleMap(this.calcSizerStyle())}>\n        ${!this.url || this.visibility === 'hidden' ? html `\n        <slot name=\"loading\" />` : null} ${this.url ? html `\n        <img src=${this.url} style=${styleMap(this.calcImageStyle())} alt=${ifDefined(this.alt)} decoding=${ifDefined(this.decoding)}\n          useMap=${ifDefined(this.useMap)} @load=${() => (this.visibility = 'visible')} />` : null}\n      </div>\n    `;\n    }\n    calcImageStyle() {\n        return { visibility: this.visibility };\n    }\n    calcSizerStyle() {\n        const { renderWidth, renderHeight, contentWidth } = this;\n        const style = {};\n        if (renderWidth !== 0 && renderHeight !== 0) {\n            if (renderWidth >= contentWidth) {\n                style.width = \"100%\";\n                style.paddingTop = `${(renderHeight / renderWidth) * 100}%`;\n            }\n            else {\n                style.width = `${renderWidth}px`;\n                style.height = `${renderHeight}px`;\n            }\n            // } else if (renderHeight !== 0) {\n            //   style.width = \"\";\n            //   style.height = `${renderHeight}px`;\n        }\n        else {\n            style.width = \"100%\";\n            style.height = \"100%\";\n        }\n        return style;\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        if (this.cache) {\n            this.cache.forEach(objURL => {\n                URL.revokeObjectURL(objURL);\n            });\n        }\n    }\n    loadImage() {\n        this.$loadImage.next(true);\n    }\n};\nHTMLHyImgElement.styles = css `\n    .sizer {\n      position: relative;\n    }\n\n    img {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n    }\n  `;\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"root\", void 0);\n__decorate([\n    property({ type: String, reflect: true, attribute: 'root-margin' })\n], HTMLHyImgElement.prototype, \"rootMargin\", void 0);\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"src\", void 0);\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"srcset\", void 0);\n__decorate([\n    property({ type: Number, reflect: true })\n], HTMLHyImgElement.prototype, \"w\", void 0);\n__decorate([\n    property({ type: Number, reflect: true })\n], HTMLHyImgElement.prototype, \"h\", void 0);\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"alt\", void 0);\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"decoding\", void 0);\n__decorate([\n    property({ type: String, reflect: true, attribute: 'usemap' })\n], HTMLHyImgElement.prototype, \"useMap\", void 0);\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"strategy\", void 0);\n__decorate([\n    property({ type: Number, reflect: false })\n], HTMLHyImgElement.prototype, \"renderWidth\", void 0);\n__decorate([\n    property({ type: Number, reflect: false })\n], HTMLHyImgElement.prototype, \"renderHeight\", void 0);\n__decorate([\n    property({ type: Number, reflect: false })\n], HTMLHyImgElement.prototype, \"contentWidth\", void 0);\n__decorate([\n    property({ type: String, reflect: false })\n], HTMLHyImgElement.prototype, \"url\", void 0);\n__decorate([\n    property({ type: String, reflect: false })\n], HTMLHyImgElement.prototype, \"visibility\", void 0);\n__decorate([\n    property()\n], HTMLHyImgElement.prototype, \"loadImage\", null);\nHTMLHyImgElement = __decorate([\n    customElement('hy-img')\n], HTMLHyImgElement);\nexport { HTMLHyImgElement };\n","export const devAssert = (_, ...args) => _;\nexport const userAssert = (_, ...args) => _;","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {devAssert, userAssert} from './log';\n\n\n/**\n * A single source within a srcset. Only one: width or DPR can be specified at\n * a time.\n * @typedef {{\n *   url: string,\n *   width: (number|undefined),\n *   dpr: (number|undefined)\n * }}\n */\nlet SrcsetSourceDef;\n\n/**\n * General grammar: (URL [NUM[w|x]],)*\n * Example 1: \"image1.png 100w, image2.png 50w\"\n * Example 2: \"image1.png 2x, image2.png\"\n * Example 3: \"image1,100w.png 100w, image2.png 50w\"\n */\nconst srcsetRegex =\n    /(\\S+)(?:\\s+(?:(-?\\d+(?:\\.\\d+)?)([a-zA-Z]*)))?\\s*(?:,|$)/g;\n\n/**\n * Extracts `srcset` and fallbacks to `src` if not available.\n * @param {!Element} element\n * @return {!Srcset}\n */\nexport function srcsetFromElement(element) {\n  const srcsetAttr = element.getAttribute('srcset');\n  if (srcsetAttr) {\n    return parseSrcset(srcsetAttr);\n  }\n  // We can't push `src` via `parseSrcset` because URLs in `src` are not always\n  // RFC compliant and can't be easily parsed as an `srcset`. For instance,\n  // they sometimes contain space characters.\n  const srcAttr = userAssert(element.getAttribute('src'),\n      'Either non-empty \"srcset\" or \"src\" attribute must be specified: %s',\n      element);\n  return srcsetFromSrc(srcAttr);\n}\n\n/**\n * Creates a Srcset from a `src` attribute value.\n * @param {string} src\n * @return {!Srcset}\n */\nexport function srcsetFromSrc(src) {\n  return new Srcset([{url: src, width: undefined, dpr: 1}]);\n}\n\n/**\n * Parses the text representation of srcset into Srcset object.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#Attributes.\n * See http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-srcset.\n * @param {string} s\n * @return {!Srcset}\n */\nexport function parseSrcset(s) {\n  const sources = [];\n  let match;\n  while ((match = srcsetRegex.exec(s))) {\n    const url = match[1];\n    let width, dpr;\n    if (match[2]) {\n      const type = match[3].toLowerCase();\n      if (type == 'w') {\n        width = parseInt(match[2], 10);\n      } else if (type == 'x') {\n        dpr = parseFloat(match[2]);\n      } else {\n        continue;\n      }\n    } else {\n      // If no \"w\" or \"x\" specified, we assume it's \"1x\".\n      dpr = 1;\n    }\n    sources.push({url, width, dpr});\n  }\n  return new Srcset(sources);\n}\n\n\n/**\n * A srcset object contains one or more sources.\n *\n * There are two types of sources: width-based and DPR-based. Only one type\n * of sources allowed to be specified within a single srcset. Depending on a\n * usecase, the components are free to choose any source that best corresponds\n * to the required rendering quality and network and CPU conditions. See\n * \"select\" method for details on how this selection is performed.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#Attributes\n */\nexport class Srcset {\n\n  /**\n   * @param {!Array<!SrcsetSourceDef>} sources\n   */\n  constructor(sources) {\n    userAssert(sources.length > 0, 'Srcset must have at least one source');\n    /** @private @const {!Array<!SrcsetSourceDef>} */\n    this.sources_ = sources;\n\n    // Only one type of source specified can be used - width or DPR.\n    let hasWidth = false;\n    let hasDpr = false;\n    for (let i = 0; i < sources.length; i++) {\n      const source = sources[i];\n      hasWidth = hasWidth || !!source.width;\n      hasDpr = hasDpr || !!source.dpr;\n    }\n    userAssert(!!(hasWidth ^ hasDpr),\n        'Srcset must have width or dpr sources, but not both');\n\n    // Source and assert duplicates.\n    sources.sort(hasWidth ? sortByWidth : sortByDpr);\n\n    /** @private @const {boolean} */\n    this.widthBased_ = hasWidth;\n  }\n\n  /**\n   * Performs selection for specified width and DPR. Here, width is the width\n   * in screen pixels and DPR is the device-pixel-ratio or pixel density of\n   * the device. Depending on the circumstances, such as low network conditions,\n   * it's possible to manipulate the result of this method by passing a lower\n   * DPR value.\n   *\n   * The source selection depends on whether this is width-based or DPR-based\n   * srcset.\n   *\n   * In a width-based source, the source's width is the physical width of a\n   * resource (e.g. an image). Depending on the provided DPR, this width is\n   * converted to the screen pixels as following:\n   *   pixelWidth = sourceWidth / DPR\n   *\n   * Then, the source closest to the requested \"width\" is selected using\n   * the \"pixelWidth\". The slight preference is given to the bigger sources to\n   * ensure the most optimal quality.\n   *\n   * In a DPR-based source, the source's DPR is used to return the source that\n   * is closest to the requested DPR.\n   *\n   * Based on\n   * http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-srcset.\n   * @param {number} width\n   * @param {number} dpr\n   * @return {string}\n   */\n  select(width, dpr) {\n    devAssert(width, 'width=%s', width);\n    devAssert(dpr, 'dpr=%s', dpr);\n    let index = 0;\n    if (this.widthBased_) {\n      index = this.selectByWidth_(width * dpr);\n    } else {\n      index = this.selectByDpr_(dpr);\n    }\n    return this.sources_[index].url;\n  }\n\n  /**\n   * @param {number} width\n   * @return {number}\n   * @private\n   */\n  selectByWidth_(width) {\n    const sources = this.sources_;\n    let minIndex = 0;\n    let minScore = Infinity;\n    let minWidth = Infinity;\n\n    for (let i = 0; i < sources.length; i++) {\n      const sWidth = sources[i].width;\n      const score = Math.abs(sWidth - width);\n\n      // Select the one that is closer with a slight preference toward larger\n      // widths. If smaller size is closer, enforce minimum ratio to ensure\n      // image isn't too distorted.\n      if (score <= minScore * 1.1 || width / minWidth > 1.2) {\n        minIndex = i;\n        minScore = score;\n        minWidth = sWidth;\n      } else {\n        break;\n      }\n    }\n    return minIndex;\n  }\n\n  /**\n   * @param {number} dpr\n   * @return {number}\n   * @private\n   */\n  selectByDpr_(dpr) {\n    const sources = this.sources_;\n    let minIndex = 0;\n    let minScore = Infinity;\n\n    for (let i = 0; i < sources.length; i++) {\n      const score = Math.abs(sources[i].dpr - dpr);\n      if (score <= minScore) {\n        minIndex = i;\n        minScore = score;\n      } else {\n        break;\n      }\n    }\n    return minIndex;\n  }\n\n  /**\n   * Returns all URLs in the srcset.\n   * @return {!Array<string>}\n   */\n  getUrls() {\n    return this.sources_.map(s => s.url);\n  }\n\n  /**\n   * Reconstructs the string expression for this srcset.\n   * @param {function(string):string=} opt_mapper\n   * @return {string}\n   */\n  stringify(opt_mapper) {\n    const res = [];\n    const sources = this.sources_;\n    for (let i = 0; i < sources.length; i++) {\n      const source = sources[i];\n      let src = source.url;\n      if (opt_mapper) {\n        src = opt_mapper(src);\n      }\n      if (this.widthBased_) {\n        src += ` ${source.width}w`;\n      } else {\n        src += ` ${source.dpr}x`;\n      }\n      res.push(src);\n    }\n    return res.join(', ');\n  }\n}\n\n/**\n * Sorts by width\n *\n * @param {number} s1\n * @param {number} s2\n * @return {number}\n */\nfunction sortByWidth(s1, s2) {\n  userAssert(s1.width != s2.width, 'Duplicate width: %s', s1.width);\n  return s1.width - s2.width;\n}\n\n/**\n * Sorts by dpr\n *\n * @param {!Object} s1\n * @param {!Object} s2\n * @return {number}\n */\nfunction sortByDpr(s1, s2) {\n  userAssert(s1.dpr != s2.dpr, 'Duplicate dpr: %s', s1.dpr);\n  return s1.dpr - s2.dpr;\n}"],"sourceRoot":""}