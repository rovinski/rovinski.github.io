{"version":3,"sources":["webpack:///../hy-img/lib/common.js","webpack:///../hy-img/lib/index.js","webpack:///../hy-img/lib/log.js","webpack:///../hy-img/lib/srcset.js"],"names":["isExternal","protocol","host","location","window","subscribeWhen","p$","source","pipe","switchMap","p","NEVER","createResizeObservable","el","Observable","create","obs","observer","ResizeObserver","xs","forEach","x","next","observe","unobserve","createItersectionObservable","options","IntersectionObserver","fetchRx","input","init","controller","AbortController","signal","response","fetch","then","r","complete","error","abort","__decorate","decorators","target","key","desc","c","arguments","length","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","RxLitElement","$connected","Subject","firstUpdate","changedProperties","keys","prop","$","LitElement","HTMLHyImgElement","w","h","strategy","url","visibility","$loadImage","cache","Map","combineLatest","root","rootMargin","document","querySelector","undefined","of","isIntersecting","map","contentRect","width","startWith","clientWidth","BehaviorSubject","src","srcset","noscript","parentNode","removeChild","$contentWidth","getContentWidth","subscribe","contentWidth","height","renderWidth","renderHeight","$trigger","merge","getIsIntersecting","share","filter","distinctUntilChanged","triggered","contentWidth$","$srcset","a","b","p1","p2","q1","q2","parseSrcset","srcsetFromSrc","$url","args","selectSrcsetURL","distinctUntilKeyChanged","$trigger2","fetchImage","catchError","srcsetObj","dpr","devicePixelRatio","selection","select","screen","URL","href","fetch$","blob","createObjectURL","has","method","headers","Accept","mode","cacheStrategy","tap","objectURL","set","get","html","styleMap","calcSizerStyle","calcImageStyle","ifDefined","alt","decoding","useMap","style","paddingTop","objURL","revokeObjectURL","styles","css","property","type","String","reflect","prototype","attribute","Number","customElement","devAssert","_","userAssert","SrcsetSourceDef","srcsetRegex","srcsetFromElement","element","srcsetAttr","getAttribute","srcAttr","Srcset","s","sources","match","exec","toLowerCase","parseInt","parseFloat","push","sources_","hasWidth","hasDpr","sort","sortByWidth","sortByDpr","widthBased_","index","selectByWidth_","selectByDpr_","minIndex","minScore","Infinity","minWidth","sWidth","score","Math","abs","opt_mapper","res","join","s1","s2"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;AACA;CAEA;;AACO,SAASA,UAAT,OAAoE;AAAA,MAA9CC,QAA8C,QAA9CA,QAA8C;AAAA,MAApCC,IAAoC,QAApCA,IAAoC;AAAA,MAA5BC,QAA4B,uEAAjBC,MAAM,CAACD,QAAU;AACvE,SAAOF,QAAQ,KAAKE,QAAQ,CAACF,QAAtB,IAAkCC,IAAI,KAAKC,QAAQ,CAACD,IAA3D;AACH;AACM,SAASG,aAAT,CAAuBC,EAAvB,EAA2B;AAC9B,SAAO,UAACC,MAAD,EAAY;AACf;AACA,WAAOD,EAAE,CAACE,IAAH,CAAQC,gEAAS,CAAC,UAAAC,CAAC;AAAA,aAAKA,CAAC,GAAGH,MAAH,GAAYI,0CAAlB;AAAA,KAAF,CAAjB,CAAP;AACH,GAHD;AAIH;AACM,SAASC,sBAAT,CAAgCC,EAAhC,EAAoC;AACvC,SAAOC,+CAAU,CAACC,MAAX,CAAkB,UAACC,GAAD,EAAS;AAC9B,QAAMC,QAAQ,GAAG,IAAIb,MAAM,CAACc,cAAX,CAA0B,UAAAC,EAAE;AAAA,aAAIA,EAAE,CAACC,OAAH,CAAW,UAAAC,CAAC;AAAA,eAAIL,GAAG,CAACM,IAAJ,CAASD,CAAT,CAAJ;AAAA,OAAZ,CAAJ;AAAA,KAA5B,CAAjB;AACAJ,YAAQ,CAACM,OAAT,CAAiBV,EAAjB;AACA,WAAO,YAAM;AAAEI,cAAQ,CAACO,SAAT,CAAmBX,EAAnB;AAAyB,KAAxC;AACH,GAJM,CAAP;AAKH;AACM,SAASY,2BAAT,CAAqCZ,EAArC,EAAyCa,OAAzC,EAAkD;AACrD,SAAOZ,+CAAU,CAACC,MAAX,CAAkB,UAACC,GAAD,EAAS;AAC9B,QAAMC,QAAQ,GAAG,IAAIU,oBAAJ,CAAyB,UAAAR,EAAE;AAAA,aAAIA,EAAE,CAACC,OAAH,CAAW,UAAAC,CAAC;AAAA,eAAIL,GAAG,CAACM,IAAJ,CAASD,CAAT,CAAJ;AAAA,OAAZ,CAAJ;AAAA,KAA3B,EAA6DK,OAA7D,CAAjB;AACAT,YAAQ,CAACM,OAAT,CAAiBV,EAAjB;AACA,WAAO,YAAM;AAAEI,cAAQ,CAACO,SAAT,CAAmBX,EAAnB;AAAyB,KAAxC;AACH,GAJM,CAAP;AAKH;AACM,SAASe,OAAT,CAAiBC,KAAjB,EAAwBC,IAAxB,EAA8B;AACjC,SAAOhB,+CAAU,CAACC,MAAX,CAAkB,UAACE,QAAD,EAAc;AACnC,QAAMc,UAAU,GAAG,IAAIC,eAAJ,EAAnB;AADmC,QAE3BC,MAF2B,GAEhBF,UAFgB,CAE3BE,MAF2B;AAGnC,QAAIC,QAAQ,GAAG,IAAf;AACAC,SAAK,CAACN,KAAD,oBAAaC,IAAb;AAAmBG,YAAM,EAANA;AAAnB,OAAL,CACKG,IADL,CACU,UAAAC,CAAC,EAAI;AACXH,cAAQ,GAAGG,CAAX;AACApB,cAAQ,CAACK,IAAT,CAAce,CAAd;AACApB,cAAQ,CAACqB,QAAT;AACH,KALD,WAMW,UAAAjB,CAAC;AAAA,aAAIJ,QAAQ,CAACsB,KAAT,CAAelB,CAAf,CAAJ;AAAA,KANZ;AAOA,WAAO,YAAM;AAAE,UAAI,CAACa,QAAL,EACXH,UAAU,CAACS,KAAX;AAAqB,KADzB;AAEH,GAbM,CAAP;AAcH;AACD;;;;;;;;;;;AAUA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvDA,IAAIC,UAAU,GAAI,SAAI,IAAI,SAAI,CAACA,UAAd,IAA6B,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACnF,MAAIC,CAAC,GAAGC,SAAS,CAACC,MAAlB;AAAA,MAA0BX,CAAC,GAAGS,CAAC,GAAG,CAAJ,GAAQH,MAAR,GAAiBE,IAAI,KAAK,IAAT,GAAgBA,IAAI,GAAGI,MAAM,CAACC,wBAAP,CAAgCP,MAAhC,EAAwCC,GAAxC,CAAvB,GAAsEC,IAArH;AAAA,MAA2HM,CAA3H;AACA,MAAI,QAAOC,OAAP,yCAAOA,OAAP,OAAmB,QAAnB,IAA+B,OAAOA,OAAO,CAACC,QAAf,KAA4B,UAA/D,EAA2EhB,CAAC,GAAGe,OAAO,CAACC,QAAR,CAAiBX,UAAjB,EAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,CAAJ,CAA3E,KACK,KAAK,IAAIS,CAAC,GAAGZ,UAAU,CAACM,MAAX,GAAoB,CAAjC,EAAoCM,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C;AAAiD,QAAIH,CAAC,GAAGT,UAAU,CAACY,CAAD,CAAlB,EAAuBjB,CAAC,GAAG,CAACS,CAAC,GAAG,CAAJ,GAAQK,CAAC,CAACd,CAAD,CAAT,GAAeS,CAAC,GAAG,CAAJ,GAAQK,CAAC,CAACR,MAAD,EAASC,GAAT,EAAcP,CAAd,CAAT,GAA4Bc,CAAC,CAACR,MAAD,EAASC,GAAT,CAA7C,KAA+DP,CAAnE;AAAxE;AACL,SAAOS,CAAC,GAAG,CAAJ,IAAST,CAAT,IAAcY,MAAM,CAACM,cAAP,CAAsBZ,MAAtB,EAA8BC,GAA9B,EAAmCP,CAAnC,CAAd,EAAqDA,CAA5D;AACH,CALD;AAMA;;;;;;;;;;;;;;;;;;;AAmBA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;IACMmB,Y;;;;;AACF,0BAAc;AAAA;;AAAA;;AACV,uFAAST,SAAT;AACA,UAAKU,UAAL,GAAkB,IAAIC,4CAAJ,EAAlB;AAFU;AAGb;;;;wCACmB;AAChB;;AACA,WAAKD,UAAL,CAAgBnC,IAAhB,CAAqB,IAArB;AACH;;;2CACsB;AACnB;;AACA,WAAKmC,UAAL,CAAgBnC,IAAhB,CAAqB,KAArB;AACH;;;mCACc;AACX,WAAKqC,WAAL,GAAmB,IAAnB;AACH;;;4BACOC,iB,EAAmB;AACvB,UAAI,CAAC,KAAKD,WAAV;AAAA;AAAA;AAAA;;AAAA;AACI,+BAAmBC,iBAAiB,CAACC,IAAlB,EAAnB,8HAA6C;AAAA,gBAAlCC,IAAkC;AACzC,gBAAIA,IAAI,IAAI,KAAKC,CAAjB,EACI,KAAKA,CAAL,CAAOD,IAAP,EAAaxC,IAAb,CAAkB,KAAKwC,IAAL,CAAlB;AACP;AAJL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKA,WAAKH,WAAL,GAAmB,KAAnB;AACH;;;;EAvBsBK,sD;;AAyB3B,IAAIC,gBAAgB;AAAA;AAAA;AAAA;;AAChB,8BAAc;AAAA;;AAAA;;AACV,4FAASlB,SAAT;AACA,WAAKmB,CAAL,GAAS,CAAT;AACA,WAAKC,CAAL,GAAS,CAAT;AACA,WAAKC,QAAL,GAAgB,OAAhB;AACA,WAAKC,GAAL,GAAW,IAAX;AACA,WAAKC,UAAL,GAAkB,QAAlB;AACA,WAAKP,CAAL,GAAS,EAAT;AACA,WAAKQ,UAAL,GAAkB,IAAIb,4CAAJ,EAAlB;AACA,WAAKc,KAAL,GAAa,IAAIC,GAAJ,EAAb;AATU;AAUb;;AAXe;AAAA;AAAA,wCAYI;AAAA;;AAChB,aAAOC,0DAAa,CAAC,KAAKX,CAAL,CAAOY,IAAR,EAAc,KAAKZ,CAAL,CAAOa,UAArB,CAAb,CAA8CpE,IAA9C,EACP;AACAC,sEAAS,CAAC;AAAA;AAAA,YAAEkE,IAAF;AAAA,YAAQC,UAAR;;AAAA,eAAwB,0BAA0BxE,MAA1B,GAC5BqB,2EAA2B,CAAC,MAAD,EAAO;AAChCkD,cAAI,EAAEA,IAAI,GAAGE,QAAQ,CAACC,aAAT,CAAuBH,IAAvB,CAAH,GAAkCI,SADZ;AAEhCH,oBAAU,EAAVA;AAFgC,SAAP,CADC,GAK5BI,+CAAE,CAAC;AAAEC,wBAAc,EAAE;AAAlB,SAAD,CALE;AAAA,OAAD,CAFF,EAO8BC,0DAAG,CAAC;AAAA,YAAGD,cAAH,SAAGA,cAAH;AAAA,eAAwBA,cAAxB;AAAA,OAAD,CAPjC,CAAP;AAQH;AArBe;AAAA;AAAA,sCAsBE;AACd,aAAO,oBAAoB7E,MAApB,GACDQ,sEAAsB,CAAC,IAAD,CAAtB,CAA6BJ,IAA7B,CAAkC0E,0DAAG,CAAC,UAAA7D,CAAC;AAAA,eAAIA,CAAC,CAAC8D,WAAF,CAAcC,KAAlB;AAAA,OAAF,CAArC,EAAiEC,gEAAS,CAAC,KAAKC,WAAN,CAA1E,CADC,GAED3E,0CAFN;AAGH;AA1Be;AAAA;AAAA,wCA2BI;AAAA;;AAChB;;AACA,WAAKoD,CAAL,CAAOY,IAAP,GAAc,IAAIY,oDAAJ,CAAoB,KAAKZ,IAAzB,CAAd;AACA,WAAKZ,CAAL,CAAOa,UAAP,GAAoB,IAAIW,oDAAJ,CAAoB,KAAKX,UAAzB,CAApB;AACA,WAAKb,CAAL,CAAOG,CAAP,GAAW,IAAIqB,oDAAJ,CAAoB,KAAKrB,CAAzB,CAAX;AACA,WAAKH,CAAL,CAAOI,CAAP,GAAW,IAAIoB,oDAAJ,CAAoB,KAAKpB,CAAzB,CAAX;AACA,WAAKJ,CAAL,CAAOyB,GAAP,GAAa,IAAID,oDAAJ,CAAoB,KAAKC,GAAzB,CAAb;AACA,WAAKzB,CAAL,CAAO0B,MAAP,GAAgB,IAAIF,oDAAJ,CAAoB,KAAKE,MAAzB,CAAhB;AACA,UAAMC,QAAQ,GAAG,KAAKZ,aAAL,CAAmB,UAAnB,CAAjB;AACA,UAAIY,QAAJ,EACIA,QAAQ,CAACC,UAAT,CAAoBC,WAApB,CAAgCF,QAAhC;AACJ,UAAMG,aAAa,GAAG,KAAKC,eAAL,EAAtB;AACApB,gEAAa,CAACmB,aAAD,EAAgB,KAAK9B,CAAL,CAAOG,CAAvB,EAA0B,KAAKH,CAAL,CAAOI,CAAjC,CAAb,CACI;AADJ,OAEK4B,SAFL,CAEe,iBAAmC;AAAA;AAAA,YAAjCC,YAAiC;AAAA,YAAnBZ,KAAmB;AAAA,YAAZa,MAAY;;AAC9C,cAAI,CAACD,YAAL,GAAoBA,YAApB;AACA,cAAI,CAACE,WAAL,GAAmBd,KAAnB;AACA,cAAI,CAACe,YAAL,GAAoBF,MAApB;AACH,OAND;AAOA,UAAMG,QAAQ,GAAGC,kDAAK,CAAC,KAAKC,iBAAL,EAAD,EAA2B,KAAK/B,UAAhC,CAAL,CAAiD/D,IAAjD,CAAsD+F,4DAAK,EAA3D,CAAjB;AACAH,cAAQ,CACH5F,IADL,CACUgG,6DAAM,CAAC,UAAAnF,CAAC;AAAA,eAAI,CAAC,CAACA,CAAN;AAAA,OAAF,CADhB,EAC4BoF,2EAAoB,EADhD,EAEKV,SAFL,CAEe;AAAA,eAAM,MAAI,CAACW,SAAL,CAAeN,QAAf,EAAyBP,aAAzB,CAAN;AAAA,OAFf;AAGH,KAlDe,CAmDhB;;AAnDgB;AAAA;AAAA,8BAoDNO,QApDM,EAoDIO,aApDJ,EAoDmB;AAAA;;AAC/B;AACA,UAAMC,OAAO,GAAGlC,0DAAa,CAAC,KAAKX,CAAL,CAAOyB,GAAR,EAAa,KAAKzB,CAAL,CAAO0B,MAApB,CAAb,CAAyCjF,IAAzC,EAChB;AACAgG,mEAAM,CAAC;AAAA;AAAA,YAAEK,CAAF;AAAA,YAAKC,CAAL;;AAAA,eAAYD,CAAC,IAAI,IAAL,IAAaC,CAAC,IAAI,IAA9B;AAAA,OAAD,CAFU,EAE4BL,2EAAoB,CAAC;AAAA;AAAA,YAAEM,EAAF;AAAA,YAAMC,EAAN;;AAAA;AAAA,YAAYC,EAAZ;AAAA,YAAgBC,EAAhB;;AAAA,eAAwBH,EAAE,KAAKE,EAAP,IAAaD,EAAE,KAAKE,EAA5C;AAAA,OAAD,CAFhD,EAEkGhC,0DAAG,CAAC;AAAA;AAAA,YAAEM,GAAF;AAAA,YAAOC,MAAP;;AAAA,eAAoBA,MAAM,GAAG0B,2DAAW,CAAC1B,MAAD,CAAd,GAAyB2B,6DAAa,CAAC5B,GAAD,CAAhE;AAAA,OAAD,CAFrG,CAAhB;AAGA,UAAM6B,IAAI,GAAG3C,0DAAa,CAACiC,aAAD,EAAgBC,OAAhB,CAAb,CAAsCpG,IAAtC,CAA2C0E,0DAAG,CAAC,UAAAoC,IAAI;AAAA,eAAI,MAAI,CAACC,eAAL,aAAI,qBAAoBD,IAApB,EAAR;AAAA,OAAL,CAA9C,EAAuFE,8EAAuB,CAAC,MAAD,CAA9G,CAAb;AACA,UAAMC,SAAS,GAAGrB,QAAQ,CAAC5F,IAAT,EAClB;AACA6E,sEAAS,CAAC,IAAD,CAFS,CAAlB;AAGAX,gEAAa,CAAC2C,IAAD,EAAOI,SAAP,CAAb,CAA+BjH,IAA/B,CAAoCC,gEAAS,CAAC,UAAA6G,IAAI;AAAA,eAAI,MAAI,CAACI,UAAL,aAAI,qBAAeJ,IAAf,EAAR;AAAA,OAAL,CAA7C,EAAiFK,iEAAU,CAAC;AAAA,eAAMN,IAAN;AAAA,OAAD,CAA3F,EACKtB,SADL,CACe,UAAA1B,GAAG,EAAI;AAClB,cAAI,CAACA,GAAL,GAAWA,GAAX;AACH,OAHD;AAIH;AAjEe;AAAA;AAAA,oCAkEAe,KAlEA,EAkEOwC,SAlEP,EAkEkB;AAC9B,UAAMC,GAAG,GAAGzH,MAAM,CAAC0H,gBAAP,IAA2B,CAAvC;AACA,UAAMC,SAAS,GAAGH,SAAS,CAACI,MAAV,CAAiB5C,KAAK,IAAIhF,MAAM,CAAC6H,MAAP,CAAc7C,KAAxC,EAA+CyC,GAA/C,CAAlB;AACA,aAAO,IAAIK,GAAJ,CAAQH,SAAR,EAAmB3H,MAAM,CAACD,QAAP,CAAgBgI,IAAnC,CAAP;AACH;AAtEe;AAAA;AAAA,kCAuEFC,MAvEE,EAuEM;AAClB,cAAQ,KAAKhE,QAAb;AACI,aAAK,MAAL;AAAa;AACT,mBAAOgE,MAAM,CAAC5H,IAAP,CAAYC,gEAAS,CAAC,UAAAY,CAAC;AAAA,qBAAIA,CAAC,CAACgH,IAAF,EAAJ;AAAA,aAAF,CAArB,EAAsCnD,0DAAG,CAAC,UAAAmD,IAAI;AAAA,qBAAIH,GAAG,CAACI,eAAJ,CAAoBD,IAApB,CAAJ;AAAA,aAAL,CAAzC,CAAP;AACH;;AACD,aAAK,OAAL;AACA;AAAS;AACL,mBAAOD,MAAM,CAAC5H,IAAP,CAAY0E,0DAAG,CAAC,UAAA7D,CAAC;AAAA,qBAAIA,CAAC,CAACgD,GAAN;AAAA,aAAF,CAAf,CAAP;AACH;AAPL;AASH;AAjFe;AAAA;AAAA,+BAkFLA,GAlFK,EAkFAY,cAlFA,EAkFgB;AAAA,UACpBkD,IADoB,GACX9D,GADW,CACpB8D,IADoB;AAAA,UAEpB3D,KAFoB,GAEV,IAFU,CAEpBA,KAFoB;;AAG5B,UAAIS,cAAc,IAAI,CAACT,KAAK,CAAC+D,GAAN,CAAUJ,IAAV,CAAvB,EAAwC;AACpC,YAAMC,MAAM,GAAGxG,uDAAO,CAACuG,IAAD,EAAO;AACzBK,gBAAM,EAAE,KADiB;AAEzBC,iBAAO,EAAE;AAAEC,kBAAM,EAAE;AAAV,WAFgB;AAGzBC,cAAI,EAAE3I,0DAAU,CAACqE,GAAD,CAAV,GAAkB,MAAlB,GAA2BU;AAHR,SAAP,CAAtB;AAKA,eAAO,KAAK6D,aAAL,CAAmBR,MAAnB,EAA2B5H,IAA3B,CAAgCqI,0DAAG,CAAC,UAAAC,SAAS;AAAA,iBAAItE,KAAK,CAACuE,GAAN,CAAUZ,IAAV,EAAgBW,SAAhB,CAAJ;AAAA,SAAV,CAAnC,CAAP;AACH,OAPD,MAQK,IAAItE,KAAK,CAAC+D,GAAN,CAAUJ,IAAV,CAAJ,EAAqB;AACtB,eAAOnD,+CAAE,CAACR,KAAK,CAACwE,GAAN,CAAUb,IAAV,CAAD,CAAT;AACH,OAFI,MAGA;AACD,eAAOxH,0CAAP;AACH;AACJ;AAnGe;AAAA;AAAA,6BAoGP;AAAA;;AACL,aAAOsI,wDAAP,oBACyBC,8EAAQ,CAAC,KAAKC,cAAL,EAAD,CADjC,EAEE,CAAC,KAAK9E,GAAN,IAAa,KAAKC,UAAL,KAAoB,QAAjC,GAA4C2E,wDAA5C,uBACyB,IAH3B,EAGmC,KAAK5E,GAAL,GAAW4E,wDAAX,qBACxB,KAAK5E,GADmB,EACN6E,8EAAQ,CAAC,KAAKE,cAAL,EAAD,CADF,EACiCC,gFAAS,CAAC,KAAKC,GAAN,CAD1C,EACiED,gFAAS,CAAC,KAAKE,QAAN,CAD1E,EAExBF,gFAAS,CAAC,KAAKG,MAAN,CAFe,EAEQ;AAAA,eAAO,MAAI,CAAClF,UAAL,GAAkB,SAAzB;AAAA,OAFR,IAEmD,IALtF;AAQH;AA7Ge;AAAA;AAAA,qCA8GC;AACb,aAAO;AAAEA,kBAAU,EAAE,KAAKA;AAAnB,OAAP;AACH;AAhHe;AAAA;AAAA,qCAiHC;AAAA,UACL4B,WADK,GACuC,IADvC,CACLA,WADK;AAAA,UACQC,YADR,GACuC,IADvC,CACQA,YADR;AAAA,UACsBH,YADtB,GACuC,IADvC,CACsBA,YADtB;AAEb,UAAMyD,KAAK,GAAG,EAAd;;AACA,UAAIvD,WAAW,KAAK,CAAhB,IAAqBC,YAAY,KAAK,CAA1C,EAA6C;AACzC,YAAID,WAAW,IAAIF,YAAnB,EAAiC;AAC7ByD,eAAK,CAACrE,KAAN,GAAc,MAAd;AACAqE,eAAK,CAACC,UAAN,aAAuBvD,YAAY,GAAGD,WAAhB,GAA+B,GAArD;AACH,SAHD,MAIK;AACDuD,eAAK,CAACrE,KAAN,aAAiBc,WAAjB;AACAuD,eAAK,CAACxD,MAAN,aAAkBE,YAAlB;AACH,SARwC,CASzC;AACA;AACA;;AACH,OAZD,MAaK;AACDsD,aAAK,CAACrE,KAAN,GAAc,MAAd;AACAqE,aAAK,CAACxD,MAAN,GAAe,MAAf;AACH;;AACD,aAAOwD,KAAP;AACH;AAtIe;AAAA;AAAA,2CAuIO;AACnB;;AACA,UAAI,KAAKjF,KAAT,EAAgB;AACZ,aAAKA,KAAL,CAAWpD,OAAX,CAAmB,UAAAuI,MAAM,EAAI;AACzBzB,aAAG,CAAC0B,eAAJ,CAAoBD,MAApB;AACH,SAFD;AAGH;AACJ;AA9Ie;AAAA;AAAA,gCA+IJ;AACR,WAAKpF,UAAL,CAAgBjD,IAAhB,CAAqB,IAArB;AACH;AAjJe;;AAAA;AAAA,EAAkCkC,YAAlC,CAApB;;AAmJAS,gBAAgB,CAAC4F,MAAjB,GAA0BC,uDAA1B;;AAYArH,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEC,MAAR;AAAgBC,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,MAFrB,EAE6B,KAAK,CAFlC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEC,MAAR;AAAgBC,SAAO,EAAE,IAAzB;AAA+BE,WAAS,EAAE;AAA1C,CAAD,CADD,CAAD,EAEPnG,gBAAgB,CAACkG,SAFV,EAEqB,YAFrB,EAEmC,KAAK,CAFxC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEC,MAAR;AAAgBC,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,KAFrB,EAE4B,KAAK,CAFjC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEC,MAAR;AAAgBC,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,QAFrB,EAE+B,KAAK,CAFpC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEK,MAAR;AAAgBH,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,GAFrB,EAE0B,KAAK,CAF/B,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEK,MAAR;AAAgBH,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,GAFrB,EAE0B,KAAK,CAF/B,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEC,MAAR;AAAgBC,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,KAFrB,EAE4B,KAAK,CAFjC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEC,MAAR;AAAgBC,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,UAFrB,EAEiC,KAAK,CAFtC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEC,MAAR;AAAgBC,SAAO,EAAE,IAAzB;AAA+BE,WAAS,EAAE;AAA1C,CAAD,CADD,CAAD,EAEPnG,gBAAgB,CAACkG,SAFV,EAEqB,QAFrB,EAE+B,KAAK,CAFpC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEC,MAAR;AAAgBC,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,UAFrB,EAEiC,KAAK,CAFtC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEK,MAAR;AAAgBH,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,aAFrB,EAEoC,KAAK,CAFzC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEK,MAAR;AAAgBH,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,cAFrB,EAEqC,KAAK,CAF1C,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEK,MAAR;AAAgBH,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,cAFrB,EAEqC,KAAK,CAF1C,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEC,MAAR;AAAgBC,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,KAFrB,EAE4B,KAAK,CAFjC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,CAAC;AAAEC,MAAI,EAAEC,MAAR;AAAgBC,SAAO,EAAE;AAAzB,CAAD,CADD,CAAD,EAEPjG,gBAAgB,CAACkG,SAFV,EAEqB,YAFrB,EAEmC,KAAK,CAFxC,CAAV;;AAGA1H,UAAU,CAAC,CACPsH,4DAAQ,EADD,CAAD,EAEP9F,gBAAgB,CAACkG,SAFV,EAEqB,WAFrB,EAEkC,IAFlC,CAAV;;AAGAlG,gBAAgB,GAAGxB,UAAU,CAAC,CAC1B6H,iEAAa,CAAC,QAAD,CADa,CAAD,EAE1BrG,gBAF0B,CAA7B;;;;;;;;;;;;;ACzQA;AAAA;AAAA;AAAO,IAAMsG,SAAS,GAAG,SAAZA,SAAY,CAACC,CAAD;AAAA,SAAgBA,CAAhB;AAAA,CAAlB;AACA,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAACD,CAAD;AAAA,SAAgBA,CAAhB;AAAA,CAAnB,C;;;;;;;;;;;;;;;;;;;;;;;;ACDP;;;;;;;;;;;;;;;AAgBA;AAGA;;;;;;;;;;AASA,IAAIE,eAAJ;AAEA;;;;;;;AAMA,IAAMC,WAAW,GACb,0DADJ;AAGA;;;;;;AAKO,SAASC,iBAAT,CAA2BC,OAA3B,EAAoC;AACzC,MAAMC,UAAU,GAAGD,OAAO,CAACE,YAAR,CAAqB,QAArB,CAAnB;;AACA,MAAID,UAAJ,EAAgB;AACd,WAAO3D,WAAW,CAAC2D,UAAD,CAAlB;AACD,GAJwC,CAKzC;AACA;AACA;;;AACA,MAAME,OAAO,GAAGP,uDAAU,CAACI,OAAO,CAACE,YAAR,CAAqB,KAArB,CAAD,EACtB,oEADsB,EAEtBF,OAFsB,CAA1B;AAGA,SAAOzD,aAAa,CAAC4D,OAAD,CAApB;AACD;AAED;;;;;;AAKO,SAAS5D,aAAT,CAAuB5B,GAAvB,EAA4B;AACjC,SAAO,IAAIyF,MAAJ,CAAW,CAAC;AAAC5G,OAAG,EAAEmB,GAAN;AAAWJ,SAAK,EAAEL,SAAlB;AAA6B8C,OAAG,EAAE;AAAlC,GAAD,CAAX,CAAP;AACD;AAED;;;;;;;;AAOO,SAASV,WAAT,CAAqB+D,CAArB,EAAwB;AAC7B,MAAMC,OAAO,GAAG,EAAhB;AACA,MAAIC,KAAJ;;AACA,SAAQA,KAAK,GAAGT,WAAW,CAACU,IAAZ,CAAiBH,CAAjB,CAAhB,EAAsC;AACpC,QAAM7G,GAAG,GAAG+G,KAAK,CAAC,CAAD,CAAjB;AACA,QAAIhG,KAAK,SAAT;AAAA,QAAWyC,GAAG,SAAd;;AACA,QAAIuD,KAAK,CAAC,CAAD,CAAT,EAAc;AACZ,UAAMpB,IAAI,GAAGoB,KAAK,CAAC,CAAD,CAAL,CAASE,WAAT,EAAb;;AACA,UAAItB,IAAI,IAAI,GAAZ,EAAiB;AACf5E,aAAK,GAAGmG,QAAQ,CAACH,KAAK,CAAC,CAAD,CAAN,EAAW,EAAX,CAAhB;AACD,OAFD,MAEO,IAAIpB,IAAI,IAAI,GAAZ,EAAiB;AACtBnC,WAAG,GAAG2D,UAAU,CAACJ,KAAK,CAAC,CAAD,CAAN,CAAhB;AACD,OAFM,MAEA;AACL;AACD;AACF,KATD,MASO;AACL;AACAvD,SAAG,GAAG,CAAN;AACD;;AACDsD,WAAO,CAACM,IAAR,CAAa;AAACpH,SAAG,EAAHA,GAAD;AAAMe,WAAK,EAALA,KAAN;AAAayC,SAAG,EAAHA;AAAb,KAAb;AACD;;AACD,SAAO,IAAIoD,MAAJ,CAAWE,OAAX,CAAP;AACD;AAGD;;;;;;;;;;;;AAWO,IAAMF,MAAb;AAAA;AAAA;AAEE;;;AAGA,kBAAYE,OAAZ,EAAqB;AAAA;;AACnBV,2DAAU,CAACU,OAAO,CAACnI,MAAR,GAAiB,CAAlB,EAAqB,sCAArB,CAAV;AACA;;AACA,SAAK0I,QAAL,GAAgBP,OAAhB,CAHmB,CAKnB;;AACA,QAAIQ,QAAQ,GAAG,KAAf;AACA,QAAIC,MAAM,GAAG,KAAb;;AACA,SAAK,IAAItI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6H,OAAO,CAACnI,MAA5B,EAAoCM,CAAC,EAArC,EAAyC;AACvC,UAAM/C,MAAM,GAAG4K,OAAO,CAAC7H,CAAD,CAAtB;AACAqI,cAAQ,GAAGA,QAAQ,IAAI,CAAC,CAACpL,MAAM,CAAC6E,KAAhC;AACAwG,YAAM,GAAGA,MAAM,IAAI,CAAC,CAACrL,MAAM,CAACsH,GAA5B;AACD;;AACD4C,2DAAU,CAAC,CAAC,EAAEkB,QAAQ,GAAGC,MAAb,CAAF,EACN,qDADM,CAAV,CAbmB,CAgBnB;;AACAT,WAAO,CAACU,IAAR,CAAaF,QAAQ,GAAGG,WAAH,GAAiBC,SAAtC;AAEA;;AACA,SAAKC,WAAL,GAAmBL,QAAnB;AACD;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA5BF;AAAA;AAAA,2BAwDSvG,KAxDT,EAwDgByC,GAxDhB,EAwDqB;AACjB0C,4DAAS,CAACnF,KAAD,EAAQ,UAAR,EAAoBA,KAApB,CAAT;AACAmF,4DAAS,CAAC1C,GAAD,EAAM,QAAN,EAAgBA,GAAhB,CAAT;AACA,UAAIoE,KAAK,GAAG,CAAZ;;AACA,UAAI,KAAKD,WAAT,EAAsB;AACpBC,aAAK,GAAG,KAAKC,cAAL,CAAoB9G,KAAK,GAAGyC,GAA5B,CAAR;AACD,OAFD,MAEO;AACLoE,aAAK,GAAG,KAAKE,YAAL,CAAkBtE,GAAlB,CAAR;AACD;;AACD,aAAO,KAAK6D,QAAL,CAAcO,KAAd,EAAqB5H,GAA5B;AACD;AAED;;;;;;AApEF;AAAA;AAAA,mCAyEiBe,KAzEjB,EAyEwB;AACpB,UAAM+F,OAAO,GAAG,KAAKO,QAArB;AACA,UAAIU,QAAQ,GAAG,CAAf;AACA,UAAIC,QAAQ,GAAGC,QAAf;AACA,UAAIC,QAAQ,GAAGD,QAAf;;AAEA,WAAK,IAAIhJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6H,OAAO,CAACnI,MAA5B,EAAoCM,CAAC,EAArC,EAAyC;AACvC,YAAMkJ,MAAM,GAAGrB,OAAO,CAAC7H,CAAD,CAAP,CAAW8B,KAA1B;AACA,YAAMqH,KAAK,GAAGC,IAAI,CAACC,GAAL,CAASH,MAAM,GAAGpH,KAAlB,CAAd,CAFuC,CAIvC;AACA;AACA;;AACA,YAAIqH,KAAK,IAAIJ,QAAQ,GAAG,GAApB,IAA2BjH,KAAK,GAAGmH,QAAR,GAAmB,GAAlD,EAAuD;AACrDH,kBAAQ,GAAG9I,CAAX;AACA+I,kBAAQ,GAAGI,KAAX;AACAF,kBAAQ,GAAGC,MAAX;AACD,SAJD,MAIO;AACL;AACD;AACF;;AACD,aAAOJ,QAAP;AACD;AAED;;;;;;AAjGF;AAAA;AAAA,iCAsGevE,GAtGf,EAsGoB;AAChB,UAAMsD,OAAO,GAAG,KAAKO,QAArB;AACA,UAAIU,QAAQ,GAAG,CAAf;AACA,UAAIC,QAAQ,GAAGC,QAAf;;AAEA,WAAK,IAAIhJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6H,OAAO,CAACnI,MAA5B,EAAoCM,CAAC,EAArC,EAAyC;AACvC,YAAMmJ,KAAK,GAAGC,IAAI,CAACC,GAAL,CAASxB,OAAO,CAAC7H,CAAD,CAAP,CAAWuE,GAAX,GAAiBA,GAA1B,CAAd;;AACA,YAAI4E,KAAK,IAAIJ,QAAb,EAAuB;AACrBD,kBAAQ,GAAG9I,CAAX;AACA+I,kBAAQ,GAAGI,KAAX;AACD,SAHD,MAGO;AACL;AACD;AACF;;AACD,aAAOL,QAAP;AACD;AAED;;;;;AAvHF;AAAA;AAAA,8BA2HY;AACR,aAAO,KAAKV,QAAL,CAAcxG,GAAd,CAAkB,UAAAgG,CAAC;AAAA,eAAIA,CAAC,CAAC7G,GAAN;AAAA,OAAnB,CAAP;AACD;AAED;;;;;;AA/HF;AAAA;AAAA,8BAoIYuI,UApIZ,EAoIwB;AACpB,UAAMC,GAAG,GAAG,EAAZ;AACA,UAAM1B,OAAO,GAAG,KAAKO,QAArB;;AACA,WAAK,IAAIpI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6H,OAAO,CAACnI,MAA5B,EAAoCM,CAAC,EAArC,EAAyC;AACvC,YAAM/C,MAAM,GAAG4K,OAAO,CAAC7H,CAAD,CAAtB;AACA,YAAIkC,GAAG,GAAGjF,MAAM,CAAC8D,GAAjB;;AACA,YAAIuI,UAAJ,EAAgB;AACdpH,aAAG,GAAGoH,UAAU,CAACpH,GAAD,CAAhB;AACD;;AACD,YAAI,KAAKwG,WAAT,EAAsB;AACpBxG,aAAG,eAAQjF,MAAM,CAAC6E,KAAf,MAAH;AACD,SAFD,MAEO;AACLI,aAAG,eAAQjF,MAAM,CAACsH,GAAf,MAAH;AACD;;AACDgF,WAAG,CAACpB,IAAJ,CAASjG,GAAT;AACD;;AACD,aAAOqH,GAAG,CAACC,IAAJ,CAAS,IAAT,CAAP;AACD;AArJH;;AAAA;AAAA;AAwJA;;;;;;;;AAOA,SAAShB,WAAT,CAAqBiB,EAArB,EAAyBC,EAAzB,EAA6B;AAC3BvC,yDAAU,CAACsC,EAAE,CAAC3H,KAAH,IAAY4H,EAAE,CAAC5H,KAAhB,EAAuB,qBAAvB,EAA8C2H,EAAE,CAAC3H,KAAjD,CAAV;AACA,SAAO2H,EAAE,CAAC3H,KAAH,GAAW4H,EAAE,CAAC5H,KAArB;AACD;AAED;;;;;;;;;AAOA,SAAS2G,SAAT,CAAmBgB,EAAnB,EAAuBC,EAAvB,EAA2B;AACzBvC,yDAAU,CAACsC,EAAE,CAAClF,GAAH,IAAUmF,EAAE,CAACnF,GAAd,EAAmB,mBAAnB,EAAwCkF,EAAE,CAAClF,GAA3C,CAAV;AACA,SAAOkF,EAAE,CAAClF,GAAH,GAASmF,EAAE,CAACnF,GAAnB;AACD,C","file":"1.hydejack-legacy-8.5.0-beta.0.js","sourcesContent":["// export const hasCSSOM = \"attributeStyleMap\" in Element.prototype && \"CSS\" in window && CSS.number;\n/* export const idle = x => new Promise(res => requestIdleCallback(() => res(x))); */\n/* export const anim = x => new Promise(res => requestAnimationFrame(() => res(x))); */\nimport { Observable, NEVER } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\n// Consider a URL external if either the protocol, hostname or port is different.\nexport function isExternal({ protocol, host }, location = window.location) {\n    return protocol !== location.protocol || host !== location.host;\n}\nexport function subscribeWhen(p$) {\n    return (source) => {\n        // if (process.env.DEBUG && !p$) throw Error();\n        return p$.pipe(switchMap(p => (p ? source : NEVER)));\n    };\n}\nexport function createResizeObservable(el) {\n    return Observable.create((obs) => {\n        const observer = new window.ResizeObserver(xs => xs.forEach(x => obs.next(x)));\n        observer.observe(el);\n        return () => { observer.unobserve(el); };\n    });\n}\nexport function createItersectionObservable(el, options) {\n    return Observable.create((obs) => {\n        const observer = new IntersectionObserver(xs => xs.forEach(x => obs.next(x)), options);\n        observer.observe(el);\n        return () => { observer.unobserve(el); };\n    });\n}\nexport function fetchRx(input, init) {\n    return Observable.create((observer) => {\n        const controller = new AbortController();\n        const { signal } = controller;\n        let response = null;\n        fetch(input, { ...init, signal })\n            .then(r => {\n            response = r;\n            observer.next(r);\n            observer.complete();\n        })\n            .catch(x => observer.error(x));\n        return () => { if (!response)\n            controller.abort(); };\n    });\n}\n/*\nfunction blobToDataURL(blob) {\n  return new Promise((res, rej) => {\n    const a = new FileReader();\n    a.onload = ({ target: { result } }) => res(result);\n    a.onerror = rej;\n    a.readAsDataURL(blob);\n  });\n}\n*/\n/*\nconst createObjectURL = blob =>\n  Observable.create(obs => {\n    const objURL = URL.createObjectURL(blob);\n    obs.next(objURL);\n    return () => {\n      if (process.env.DEBUG) console.log(\"revoke\", objURL);\n      URL.revokeObjectURL(objURL);\n    };\n  });\n*/\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n/**\n * Copyright (c) 2019 Florian Klampfer <https://qwtel.com/>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @license\n * @nocompile\n */\n// import { h, Component, Prop, Element, Watch, State, Method } from 'pencil-runtime';\nimport { LitElement, html, css, property, customElement } from 'lit-element';\nimport { styleMap } from 'lit-html/directives/style-map';\nimport { ifDefined } from 'lit-html/directives/if-defined';\nimport { Subject, BehaviorSubject, combineLatest, merge, NEVER, of } from \"rxjs\";\nimport { catchError, distinctUntilChanged, distinctUntilKeyChanged, filter, map, share, startWith, switchMap, tap } from \"rxjs/operators\";\nimport { isExternal, createResizeObservable, createItersectionObservable, fetchRx } from \"./common\";\nimport { parseSrcset, srcsetFromSrc } from './srcset';\nclass RxLitElement extends LitElement {\n    constructor() {\n        super(...arguments);\n        this.$connected = new Subject();\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this.$connected.next(true);\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        this.$connected.next(false);\n    }\n    firstUpdated() {\n        this.firstUpdate = true;\n    }\n    updated(changedProperties) {\n        if (!this.firstUpdate)\n            for (const prop of changedProperties.keys()) {\n                if (prop in this.$)\n                    this.$[prop].next(this[prop]);\n            }\n        this.firstUpdate = false;\n    }\n}\nlet HTMLHyImgElement = class HTMLHyImgElement extends RxLitElement {\n    constructor() {\n        super(...arguments);\n        this.w = 0;\n        this.h = 0;\n        this.strategy = 'cache';\n        this.url = null;\n        this.visibility = 'hidden';\n        this.$ = {};\n        this.$loadImage = new Subject();\n        this.cache = new Map();\n    }\n    getIsIntersecting() {\n        return combineLatest(this.$.root, this.$.rootMargin).pipe(\n        // subscribeWhen(this.connected$),\n        switchMap(([root, rootMargin]) => \"IntersectionObserver\" in window\n            ? createItersectionObservable(this, {\n                root: root ? document.querySelector(root) : undefined,\n                rootMargin,\n            })\n            : of({ isIntersecting: true })), map(({ isIntersecting }) => isIntersecting));\n    }\n    getContentWidth() {\n        return \"ResizeObserver\" in window\n            ? createResizeObservable(this).pipe(map(x => x.contentRect.width), startWith(this.clientWidth))\n            : NEVER;\n    }\n    connectedCallback() {\n        super.connectedCallback();\n        this.$.root = new BehaviorSubject(this.root);\n        this.$.rootMargin = new BehaviorSubject(this.rootMargin);\n        this.$.w = new BehaviorSubject(this.w);\n        this.$.h = new BehaviorSubject(this.h);\n        this.$.src = new BehaviorSubject(this.src);\n        this.$.srcset = new BehaviorSubject(this.srcset);\n        const noscript = this.querySelector('noscript');\n        if (noscript)\n            noscript.parentNode.removeChild(noscript);\n        const $contentWidth = this.getContentWidth();\n        combineLatest($contentWidth, this.$.w, this.$.h)\n            // .pipe(subscribeWhen(this.connected$))\n            .subscribe(([contentWidth, width, height]) => {\n            this.contentWidth = contentWidth;\n            this.renderWidth = width;\n            this.renderHeight = height;\n        });\n        const $trigger = merge(this.getIsIntersecting(), this.$loadImage).pipe(share());\n        $trigger\n            .pipe(filter(x => !!x), distinctUntilChanged())\n            .subscribe(() => this.triggered($trigger, $contentWidth));\n    }\n    // TODO: rename\n    triggered($trigger, contentWidth$) {\n        // this.loading = true;\n        const $srcset = combineLatest(this.$.src, this.$.srcset).pipe(\n        // subscribeWhen(this.connected$),\n        filter(([a, b]) => a != null || b != null), distinctUntilChanged(([p1, p2], [q1, q2]) => p1 === q1 && p2 === q2), map(([src, srcset]) => (srcset ? parseSrcset(srcset) : srcsetFromSrc(src))));\n        const $url = combineLatest(contentWidth$, $srcset).pipe(map(args => this.selectSrcsetURL(...args)), distinctUntilKeyChanged(\"href\"));\n        const $trigger2 = $trigger.pipe(\n        // distinctUntilChanged(), // ???\n        startWith(true));\n        combineLatest($url, $trigger2).pipe(switchMap(args => this.fetchImage(...args)), catchError(() => $url))\n            .subscribe(url => {\n            this.url = url;\n        });\n    }\n    selectSrcsetURL(width, srcsetObj) {\n        const dpr = window.devicePixelRatio || 1;\n        const selection = srcsetObj.select(width || window.screen.width, dpr);\n        return new URL(selection, window.location.href);\n    }\n    cacheStrategy(fetch$) {\n        switch (this.strategy) {\n            case 'blob': {\n                return fetch$.pipe(switchMap(x => x.blob()), map(blob => URL.createObjectURL(blob)));\n            }\n            case 'cache':\n            default: {\n                return fetch$.pipe(map(x => x.url));\n            }\n        }\n    }\n    fetchImage(url, isIntersecting) {\n        const { href } = url;\n        const { cache } = this;\n        if (isIntersecting && !cache.has(href)) {\n            const fetch$ = fetchRx(href, {\n                method: \"GET\",\n                headers: { Accept: \"image/*\" },\n                mode: isExternal(url) ? 'cors' : undefined,\n            });\n            return this.cacheStrategy(fetch$).pipe(tap(objectURL => cache.set(href, objectURL)));\n        }\n        else if (cache.has(href)) {\n            return of(cache.get(href));\n        }\n        else {\n            return NEVER;\n        }\n    }\n    render() {\n        return html `\n      <div class=\"sizer\" style=${styleMap(this.calcSizerStyle())}>\n        ${!this.url || this.visibility === 'hidden' ? html `\n        <slot name=\"loading\" />` : null} ${this.url ? html `\n        <img src=${this.url} style=${styleMap(this.calcImageStyle())} alt=${ifDefined(this.alt)} decoding=${ifDefined(this.decoding)}\n          useMap=${ifDefined(this.useMap)} @load=${() => (this.visibility = 'visible')} />` : null}\n      </div>\n    `;\n    }\n    calcImageStyle() {\n        return { visibility: this.visibility };\n    }\n    calcSizerStyle() {\n        const { renderWidth, renderHeight, contentWidth } = this;\n        const style = {};\n        if (renderWidth !== 0 && renderHeight !== 0) {\n            if (renderWidth >= contentWidth) {\n                style.width = \"100%\";\n                style.paddingTop = `${(renderHeight / renderWidth) * 100}%`;\n            }\n            else {\n                style.width = `${renderWidth}px`;\n                style.height = `${renderHeight}px`;\n            }\n            // } else if (renderHeight !== 0) {\n            //   style.width = \"\";\n            //   style.height = `${renderHeight}px`;\n        }\n        else {\n            style.width = \"100%\";\n            style.height = \"100%\";\n        }\n        return style;\n    }\n    disconnectedCallback() {\n        super.disconnectedCallback();\n        if (this.cache) {\n            this.cache.forEach(objURL => {\n                URL.revokeObjectURL(objURL);\n            });\n        }\n    }\n    loadImage() {\n        this.$loadImage.next(true);\n    }\n};\nHTMLHyImgElement.styles = css `\n    .sizer {\n      position: relative;\n    }\n\n    img {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n    }\n  `;\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"root\", void 0);\n__decorate([\n    property({ type: String, reflect: true, attribute: 'root-margin' })\n], HTMLHyImgElement.prototype, \"rootMargin\", void 0);\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"src\", void 0);\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"srcset\", void 0);\n__decorate([\n    property({ type: Number, reflect: true })\n], HTMLHyImgElement.prototype, \"w\", void 0);\n__decorate([\n    property({ type: Number, reflect: true })\n], HTMLHyImgElement.prototype, \"h\", void 0);\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"alt\", void 0);\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"decoding\", void 0);\n__decorate([\n    property({ type: String, reflect: true, attribute: 'usemap' })\n], HTMLHyImgElement.prototype, \"useMap\", void 0);\n__decorate([\n    property({ type: String, reflect: true })\n], HTMLHyImgElement.prototype, \"strategy\", void 0);\n__decorate([\n    property({ type: Number, reflect: false })\n], HTMLHyImgElement.prototype, \"renderWidth\", void 0);\n__decorate([\n    property({ type: Number, reflect: false })\n], HTMLHyImgElement.prototype, \"renderHeight\", void 0);\n__decorate([\n    property({ type: Number, reflect: false })\n], HTMLHyImgElement.prototype, \"contentWidth\", void 0);\n__decorate([\n    property({ type: String, reflect: false })\n], HTMLHyImgElement.prototype, \"url\", void 0);\n__decorate([\n    property({ type: String, reflect: false })\n], HTMLHyImgElement.prototype, \"visibility\", void 0);\n__decorate([\n    property()\n], HTMLHyImgElement.prototype, \"loadImage\", null);\nHTMLHyImgElement = __decorate([\n    customElement('hy-img')\n], HTMLHyImgElement);\nexport { HTMLHyImgElement };\n","export const devAssert = (_, ...args) => _;\nexport const userAssert = (_, ...args) => _;","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {devAssert, userAssert} from './log';\n\n\n/**\n * A single source within a srcset. Only one: width or DPR can be specified at\n * a time.\n * @typedef {{\n *   url: string,\n *   width: (number|undefined),\n *   dpr: (number|undefined)\n * }}\n */\nlet SrcsetSourceDef;\n\n/**\n * General grammar: (URL [NUM[w|x]],)*\n * Example 1: \"image1.png 100w, image2.png 50w\"\n * Example 2: \"image1.png 2x, image2.png\"\n * Example 3: \"image1,100w.png 100w, image2.png 50w\"\n */\nconst srcsetRegex =\n    /(\\S+)(?:\\s+(?:(-?\\d+(?:\\.\\d+)?)([a-zA-Z]*)))?\\s*(?:,|$)/g;\n\n/**\n * Extracts `srcset` and fallbacks to `src` if not available.\n * @param {!Element} element\n * @return {!Srcset}\n */\nexport function srcsetFromElement(element) {\n  const srcsetAttr = element.getAttribute('srcset');\n  if (srcsetAttr) {\n    return parseSrcset(srcsetAttr);\n  }\n  // We can't push `src` via `parseSrcset` because URLs in `src` are not always\n  // RFC compliant and can't be easily parsed as an `srcset`. For instance,\n  // they sometimes contain space characters.\n  const srcAttr = userAssert(element.getAttribute('src'),\n      'Either non-empty \"srcset\" or \"src\" attribute must be specified: %s',\n      element);\n  return srcsetFromSrc(srcAttr);\n}\n\n/**\n * Creates a Srcset from a `src` attribute value.\n * @param {string} src\n * @return {!Srcset}\n */\nexport function srcsetFromSrc(src) {\n  return new Srcset([{url: src, width: undefined, dpr: 1}]);\n}\n\n/**\n * Parses the text representation of srcset into Srcset object.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#Attributes.\n * See http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-srcset.\n * @param {string} s\n * @return {!Srcset}\n */\nexport function parseSrcset(s) {\n  const sources = [];\n  let match;\n  while ((match = srcsetRegex.exec(s))) {\n    const url = match[1];\n    let width, dpr;\n    if (match[2]) {\n      const type = match[3].toLowerCase();\n      if (type == 'w') {\n        width = parseInt(match[2], 10);\n      } else if (type == 'x') {\n        dpr = parseFloat(match[2]);\n      } else {\n        continue;\n      }\n    } else {\n      // If no \"w\" or \"x\" specified, we assume it's \"1x\".\n      dpr = 1;\n    }\n    sources.push({url, width, dpr});\n  }\n  return new Srcset(sources);\n}\n\n\n/**\n * A srcset object contains one or more sources.\n *\n * There are two types of sources: width-based and DPR-based. Only one type\n * of sources allowed to be specified within a single srcset. Depending on a\n * usecase, the components are free to choose any source that best corresponds\n * to the required rendering quality and network and CPU conditions. See\n * \"select\" method for details on how this selection is performed.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#Attributes\n */\nexport class Srcset {\n\n  /**\n   * @param {!Array<!SrcsetSourceDef>} sources\n   */\n  constructor(sources) {\n    userAssert(sources.length > 0, 'Srcset must have at least one source');\n    /** @private @const {!Array<!SrcsetSourceDef>} */\n    this.sources_ = sources;\n\n    // Only one type of source specified can be used - width or DPR.\n    let hasWidth = false;\n    let hasDpr = false;\n    for (let i = 0; i < sources.length; i++) {\n      const source = sources[i];\n      hasWidth = hasWidth || !!source.width;\n      hasDpr = hasDpr || !!source.dpr;\n    }\n    userAssert(!!(hasWidth ^ hasDpr),\n        'Srcset must have width or dpr sources, but not both');\n\n    // Source and assert duplicates.\n    sources.sort(hasWidth ? sortByWidth : sortByDpr);\n\n    /** @private @const {boolean} */\n    this.widthBased_ = hasWidth;\n  }\n\n  /**\n   * Performs selection for specified width and DPR. Here, width is the width\n   * in screen pixels and DPR is the device-pixel-ratio or pixel density of\n   * the device. Depending on the circumstances, such as low network conditions,\n   * it's possible to manipulate the result of this method by passing a lower\n   * DPR value.\n   *\n   * The source selection depends on whether this is width-based or DPR-based\n   * srcset.\n   *\n   * In a width-based source, the source's width is the physical width of a\n   * resource (e.g. an image). Depending on the provided DPR, this width is\n   * converted to the screen pixels as following:\n   *   pixelWidth = sourceWidth / DPR\n   *\n   * Then, the source closest to the requested \"width\" is selected using\n   * the \"pixelWidth\". The slight preference is given to the bigger sources to\n   * ensure the most optimal quality.\n   *\n   * In a DPR-based source, the source's DPR is used to return the source that\n   * is closest to the requested DPR.\n   *\n   * Based on\n   * http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-srcset.\n   * @param {number} width\n   * @param {number} dpr\n   * @return {string}\n   */\n  select(width, dpr) {\n    devAssert(width, 'width=%s', width);\n    devAssert(dpr, 'dpr=%s', dpr);\n    let index = 0;\n    if (this.widthBased_) {\n      index = this.selectByWidth_(width * dpr);\n    } else {\n      index = this.selectByDpr_(dpr);\n    }\n    return this.sources_[index].url;\n  }\n\n  /**\n   * @param {number} width\n   * @return {number}\n   * @private\n   */\n  selectByWidth_(width) {\n    const sources = this.sources_;\n    let minIndex = 0;\n    let minScore = Infinity;\n    let minWidth = Infinity;\n\n    for (let i = 0; i < sources.length; i++) {\n      const sWidth = sources[i].width;\n      const score = Math.abs(sWidth - width);\n\n      // Select the one that is closer with a slight preference toward larger\n      // widths. If smaller size is closer, enforce minimum ratio to ensure\n      // image isn't too distorted.\n      if (score <= minScore * 1.1 || width / minWidth > 1.2) {\n        minIndex = i;\n        minScore = score;\n        minWidth = sWidth;\n      } else {\n        break;\n      }\n    }\n    return minIndex;\n  }\n\n  /**\n   * @param {number} dpr\n   * @return {number}\n   * @private\n   */\n  selectByDpr_(dpr) {\n    const sources = this.sources_;\n    let minIndex = 0;\n    let minScore = Infinity;\n\n    for (let i = 0; i < sources.length; i++) {\n      const score = Math.abs(sources[i].dpr - dpr);\n      if (score <= minScore) {\n        minIndex = i;\n        minScore = score;\n      } else {\n        break;\n      }\n    }\n    return minIndex;\n  }\n\n  /**\n   * Returns all URLs in the srcset.\n   * @return {!Array<string>}\n   */\n  getUrls() {\n    return this.sources_.map(s => s.url);\n  }\n\n  /**\n   * Reconstructs the string expression for this srcset.\n   * @param {function(string):string=} opt_mapper\n   * @return {string}\n   */\n  stringify(opt_mapper) {\n    const res = [];\n    const sources = this.sources_;\n    for (let i = 0; i < sources.length; i++) {\n      const source = sources[i];\n      let src = source.url;\n      if (opt_mapper) {\n        src = opt_mapper(src);\n      }\n      if (this.widthBased_) {\n        src += ` ${source.width}w`;\n      } else {\n        src += ` ${source.dpr}x`;\n      }\n      res.push(src);\n    }\n    return res.join(', ');\n  }\n}\n\n/**\n * Sorts by width\n *\n * @param {number} s1\n * @param {number} s2\n * @return {number}\n */\nfunction sortByWidth(s1, s2) {\n  userAssert(s1.width != s2.width, 'Duplicate width: %s', s1.width);\n  return s1.width - s2.width;\n}\n\n/**\n * Sorts by dpr\n *\n * @param {!Object} s1\n * @param {!Object} s2\n * @return {number}\n */\nfunction sortByDpr(s1, s2) {\n  userAssert(s1.dpr != s2.dpr, 'Duplicate dpr: %s', s1.dpr);\n  return s1.dpr - s2.dpr;\n}"],"sourceRoot":""}